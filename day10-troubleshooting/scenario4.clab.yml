# Day 10: シナリオ 4 - ファイアウォール設定ミス
#
# 症状: host-internal → host-external の ping は通る
#        host-external → host-dmz の HTTP（TCP 80）が通らない
# 原因: ???（自分で調査してください）
#
# 構成:
#   host-internal ── router-fw ── host-external
#                       │
#                    host-dmz
#
# 使い方:
#   1. sudo containerlab deploy -t scenario4.clab.yml
#   2. ./setup-scenario4.sh  # 設定投入

name: scenario4

topology:
  nodes:
    router-fw:
      kind: linux
      image: ghcr.io/vyos/vyos:current

    host-internal:
      kind: linux
      image: alpine:latest
      exec:
        - ip addr add 192.168.1.10/24 dev eth1
        - ip route add default via 192.168.1.1

    host-dmz:
      kind: linux
      image: alpine:latest
      exec:
        - ip addr add 172.16.0.10/24 dev eth1
        - ip route add default via 172.16.0.1

    host-external:
      kind: linux
      image: alpine:latest
      exec:
        - ip addr add 203.0.113.10/24 dev eth1
        - ip route add default via 203.0.113.1

  links:
    - endpoints: ["host-internal:eth1", "router-fw:eth1"]
    - endpoints: ["host-dmz:eth1", "router-fw:eth2"]
    - endpoints: ["host-external:eth1", "router-fw:eth3"]
