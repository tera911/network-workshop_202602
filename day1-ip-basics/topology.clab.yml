# Day 1: IPアドレスと疎通確認 - 完成版トポロジ
#
# 構成:
#   host1 --- router1 --- router2 --- host2
#
# ネットワーク:
#   host1 - router1: 192.168.1.0/24
#   router1 - router2: 10.0.0.0/24
#   router2 - host2: 192.168.2.0/24

name: day1-ip-basics

topology:
  nodes:
    # ルーター
    router1:
      kind: linux
      image: ghcr.io/vyos/vyos:current
      exec:
        - /bin/bash -c "vtysh -c 'configure terminal' -c 'interface eth1' -c 'ip address 192.168.1.1/24' -c 'exit' -c 'interface eth2' -c 'ip address 10.0.0.1/24' -c 'exit' -c 'ip route 192.168.2.0/24 10.0.0.2' -c 'end' -c 'write memory'" || true
      binds:
        - configs/router1.conf:/opt/vyatta/etc/config/config.boot:ro

    router2:
      kind: linux
      image: ghcr.io/vyos/vyos:current
      exec:
        - /bin/bash -c "vtysh -c 'configure terminal' -c 'interface eth1' -c 'ip address 10.0.0.2/24' -c 'exit' -c 'interface eth2' -c 'ip address 192.168.2.1/24' -c 'exit' -c 'ip route 192.168.1.0/24 10.0.0.1' -c 'end' -c 'write memory'" || true
      binds:
        - configs/router2.conf:/opt/vyatta/etc/config/config.boot:ro

    # ホスト（Alpine Linux）
    host1:
      kind: linux
      image: alpine:latest
      exec:
        - ip addr add 192.168.1.10/24 dev eth1
        - ip route add default via 192.168.1.1

    host2:
      kind: linux
      image: alpine:latest
      exec:
        - ip addr add 192.168.2.10/24 dev eth1
        - ip route add default via 192.168.2.1

  links:
    - endpoints: ["host1:eth1", "router1:eth1"]
    - endpoints: ["router1:eth2", "router2:eth1"]
    - endpoints: ["router2:eth2", "host2:eth1"]
