# Day 6: DHCP / DNS - 演習用トポロジ（穴あき版）
#
# 【演習】
# router-gw に DHCP サーバーと DNS フォワーダーを設定して、
# host-pc1 と host-pc2 に自動で IP アドレスを配布してください。
#
# 構成:
#   host-pc1(DHCP) ──┐
#   host-pc2(DHCP) ──┤── switch ── router-gw(DHCP/DNS 未設定)
#   host-pc3(手動)  ──┘
#
# ネットワーク設計:
#   LAN: 192.168.1.0/24
#   DHCP プール: 192.168.1.100 - 192.168.1.200

name: day6-exercise

topology:
  nodes:
    # DHCP サーバー / DNS フォワーダー（未設定）
    router-gw:
      kind: linux
      image: ghcr.io/vyos/vyos:current
      # 演習: DHCP サーバーと DNS フォワーダーを設定してください

    # L2 スイッチ（Linux Bridge - 設定済み）
    switch:
      kind: linux
      image: alpine:latest
      exec:
        - apk add --no-cache bridge-utils iproute2
        - ip link add br0 type bridge
        - ip link set br0 up
        - ip link set eth1 master br0
        - ip link set eth2 master br0
        - ip link set eth3 master br0
        - ip link set eth4 master br0
        - ip link set eth1 up
        - ip link set eth2 up
        - ip link set eth3 up
        - ip link set eth4 up

    # DHCP クライアント（設定後に udhcpc を実行）
    host-pc1:
      kind: linux
      image: alpine:latest

    host-pc2:
      kind: linux
      image: alpine:latest

    # 手動設定ホスト（設定済み）
    host-pc3:
      kind: linux
      image: alpine:latest
      exec:
        - ip addr add 192.168.1.50/24 dev eth1
        - ip route replace default via 192.168.1.1

  links:
    - endpoints: ["router-gw:eth1", "switch:eth1"]
    - endpoints: ["switch:eth2", "host-pc1:eth1"]
    - endpoints: ["switch:eth3", "host-pc2:eth1"]
    - endpoints: ["switch:eth4", "host-pc3:eth1"]
