# Day 6: DHCP / DNS - 完成版トポロジ
#
# 構成:
#   host-pc1(DHCP) ──┐
#   host-pc2(DHCP) ──┤── switch ── router-gw(DHCP Server / DNS Forwarder)
#   host-pc3(手動)  ──┘
#
# ネットワーク設計:
#   LAN: 192.168.1.0/24
#   DHCP プール: 192.168.1.100 - 192.168.1.200
#
# 使い方:
#   1. sudo containerlab deploy -t topology.clab.yml
#   2. ./setup-complete.sh  # 設定投入スクリプト実行

name: day6-dhcp-dns

topology:
  nodes:
    # DHCP サーバー / DNS フォワーダー（VyOS）
    router-gw:
      kind: linux
      image: ghcr.io/vyos/vyos:current

    # L2 スイッチ（Linux Bridge）
    switch:
      kind: linux
      image: alpine:latest
      exec:
        - apk add --no-cache bridge-utils iproute2
        - ip link add br0 type bridge
        - ip link set br0 up
        - ip link set eth1 master br0
        - ip link set eth2 master br0
        - ip link set eth3 master br0
        - ip link set eth4 master br0
        - ip link set eth1 up
        - ip link set eth2 up
        - ip link set eth3 up
        - ip link set eth4 up

    # DHCP クライアント（IP未設定 - setup-complete.sh で取得）
    host-pc1:
      kind: linux
      image: alpine:latest

    host-pc2:
      kind: linux
      image: alpine:latest

    # 手動設定ホスト
    host-pc3:
      kind: linux
      image: alpine:latest
      exec:
        - ip addr add 192.168.1.50/24 dev eth1
        - ip route add default via 192.168.1.1

  links:
    - endpoints: ["router-gw:eth1", "switch:eth1"]
    - endpoints: ["switch:eth2", "host-pc1:eth1"]
    - endpoints: ["switch:eth3", "host-pc2:eth1"]
    - endpoints: ["switch:eth4", "host-pc3:eth1"]
