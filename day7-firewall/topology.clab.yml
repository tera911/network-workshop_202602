# Day 7: ファイアウォール - 完成版トポロジ
#
# 構成（3ゾーン）:
#   host-internal ── router-fw ── host-external
#                       │
#                    host-dmz
#
# ネットワーク設計:
#   内部ゾーン: 192.168.1.0/24
#   DMZ ゾーン: 172.16.0.0/24
#   外部ゾーン: 203.0.113.0/24
#
# 使い方:
#   1. sudo containerlab deploy -t topology.clab.yml
#   2. ./setup-complete.sh  # 設定投入スクリプト実行

name: day7-firewall

topology:
  nodes:
    # ファイアウォールルーター（VyOS）
    router-fw:
      kind: linux
      image: ghcr.io/vyos/vyos:current

    # 内部ゾーン
    host-internal:
      kind: linux
      image: alpine:latest
      exec:
        - ip addr add 192.168.1.10/24 dev eth1
        - ip route replace default via 192.168.1.1

    # DMZ ゾーン（Web サーバー）
    host-dmz:
      kind: linux
      image: alpine:latest
      exec:
        - ip addr add 172.16.0.10/24 dev eth1
        - ip route replace default via 172.16.0.1

    # 外部ゾーン
    host-external:
      kind: linux
      image: alpine:latest
      exec:
        - ip addr add 203.0.113.10/24 dev eth1
        - ip route replace default via 203.0.113.1

  links:
    # 内部
    - endpoints: ["host-internal:eth1", "router-fw:eth1"]
    # DMZ
    - endpoints: ["host-dmz:eth1", "router-fw:eth2"]
    # 外部
    - endpoints: ["host-external:eth1", "router-fw:eth3"]
